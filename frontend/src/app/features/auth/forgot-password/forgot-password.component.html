<div class="forgot-password-container">
  <div class="forgot-password-card">
    
    <!-- STEP 1: Enter Email -->
    <div *ngIf="currentStep === 'email'" class="step-content">
      <div class="header">
        <h1>ğŸ”’ Forgot Password?</h1>
        <p>Enter your registered email to receive an OTP</p>
      </div>

      <form [formGroup]="emailForm" (ngSubmit)="sendOtp()">
        <div class="form-group">
          <label class="form-label" for="email">
            Email Address <span class="required">*</span>
          </label>
          <input 
            type="email" 
            id="email"
            class="form-control" 
            formControlName="email"
            placeholder="Enter your email"
            [class.error]="emailControl['email'].invalid && emailControl['email'].touched">
          
          <div class="error-message" *ngIf="emailControl['email'].invalid && emailControl['email'].touched">
            <span *ngIf="emailControl['email'].errors?.['required']">Email is required</span>
            <span *ngIf="emailControl['email'].errors?.['email']">Invalid email format</span>
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="loading">
          <span *ngIf="!loading">Send OTP</span>
          <span *ngIf="loading">Sending...</span>
        </button>
      </form>

      <div class="back-link">
        <a routerLink="/login">â† Back to Login</a>
      </div>
    </div>

    <!-- STEP 2: Enter OTP -->
    <div *ngIf="currentStep === 'otp'" class="step-content">
      <div class="header">
        <h1>ğŸ“§ Verify OTP</h1>
        <p>Enter the 6-digit code sent to</p>
        <p class="email-display">{{ userEmail }}</p>
      </div>

      <form [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
        <div class="form-group">
          <label class="form-label">
            Enter OTP <span class="required">*</span>
          </label>
          
          <!-- Manual Paste Button -->
          <div style="text-align: center; margin-bottom: 10px;">
            <button 
              type="button" 
              class="btn-link"
              (click)="handlePasteFromClipboard(0)"
              style="font-size: 12px;">
              ğŸ“‹ Paste from Clipboard
            </button>
          </div>
          
          <div class="otp-input-container">
            <input 
              type="text"
              id="otp-0"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(0, $event)"
              (keydown)="onOtpKeydown(0, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(0)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
            
            <input 
              type="text"
              id="otp-1"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(1, $event)"
              (keydown)="onOtpKeydown(1, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(1)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
            
            <input 
              type="text"
              id="otp-2"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(2, $event)"
              (keydown)="onOtpKeydown(2, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(2)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
            
            <input 
              type="text"
              id="otp-3"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(3, $event)"
              (keydown)="onOtpKeydown(3, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(3)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
            
            <input 
              type="text"
              id="otp-4"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(4, $event)"
              (keydown)="onOtpKeydown(4, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(4)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
            
            <input 
              type="text"
              id="otp-5"
              class="otp-input"
              maxlength="1"
              (input)="onOtpInput(5, $event)"
              (keydown)="onOtpKeydown(5, $event)"
              (paste)="onOtpPaste($event)"
              (contextmenu)="handlePasteFromClipboard(5)"
              pattern="[0-9]"
              inputmode="numeric"
              autocomplete="off">
          </div>
          
          <p style="font-size: 11px; color: #666; text-align: center; margin-top: 8px;">
            Try: Click "ğŸ“‹ Paste from Clipboard" button, or right-click on any field
          </p>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="loading">
          Verify OTP
        </button>

        <div class="resend-section">
          <p>Didn't receive the code?</p>
          <button 
            type="button" 
            class="btn-link"
            (click)="resendOtp()"
            [disabled]="loading">
            Resend OTP
          </button>
        </div>
      </form>

      <div class="back-link">
        <a (click)="goBack()" style="cursor: pointer">â† Change Email</a>
      </div>
    </div>

    <!-- STEP 3: Set New Password -->
    <div *ngIf="currentStep === 'password'" class="step-content">
      <div class="header">
        <h1>ğŸ” Create New Password</h1>
        <p>Set a strong password for your account</p>
      </div>

      <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
        
        <!-- New Password -->
        <div class="form-group">
          <label class="form-label" for="newPassword">
            New Password <span class="required">*</span>
          </label>
          <div class="password-wrapper">
            <input 
              [type]="showPassword ? 'text' : 'password'"
              id="newPassword"
              class="form-control" 
              formControlName="newPassword"
              placeholder="Enter new password"
              [class.error]="passwordControl['newPassword'].invalid && passwordControl['newPassword'].touched">
            
            <button 
              type="button" 
              class="toggle-password"
              (click)="togglePasswordVisibility('password')">
              {{ showPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>

          <div class="error-message" *ngIf="passwordControl['newPassword'].invalid && passwordControl['newPassword'].touched">
            <span *ngIf="passwordControl['newPassword'].errors?.['required']">Password is required</span>
            <span *ngIf="passwordControl['newPassword'].errors?.['minlength']">
              Password must be at least 6 characters
            </span>
          </div>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label class="form-label" for="confirmPassword">
            Confirm Password <span class="required">*</span>
          </label>
          <div class="password-wrapper">
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              class="form-control" 
              formControlName="confirmPassword"
              placeholder="Re-enter your password"
              [class.error]="(passwordControl['confirmPassword'].invalid || passwordForm.errors?.['passwordMismatch']) && passwordControl['confirmPassword'].touched">
            
            <button 
              type="button" 
              class="toggle-password"
              (click)="togglePasswordVisibility('confirmPassword')">
              {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>

          <div class="error-message" *ngIf="passwordControl['confirmPassword'].touched">
            <span *ngIf="passwordControl['confirmPassword'].errors?.['required']">Please confirm your password</span>
            <span *ngIf="passwordForm.errors?.['passwordMismatch'] && !passwordControl['confirmPassword'].errors?.['required']">
              Passwords do not match
            </span>
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="loading">
          <span *ngIf="!loading">Reset Password</span>
          <span *ngIf="loading">Resetting...</span>
        </button>
      </form>

      <div class="back-link">
        <a (click)="goBack()" style="cursor: pointer">â† Re-enter OTP</a>
      </div>
    </div>

  </div>

  <!-- Loader -->
  <app-loader *ngIf="loading"></app-loader>
</div>